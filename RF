import csv
import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn import preprocessing
from sklearn.utils import shuffle
from sklearn.metrics import mean_squared_error, explained_variance_score
import pandas as pd
from sklearn.model_selection import cross_val_score
import joblib
import sklearn
import time
def load_dataset(filename):
    file_reader = csv.reader(open(filename, 'rt', encoding='UTF-8'), delimiter=',')
    X, y = [], []
    for row in file_reader:
        X.append(row[0:-7])
        y.append(row[-3])
    # Extract feature names
    #feature_names = np.array(X[0])
    return np.array(X[0:]).astype(np.float32), np.array(y[0:]).astype(np.float32)#, feature_names
def random_forest(data_path):
    X, y= load_dataset(data_path)
    X, y = shuffle(X, y, random_state=7)  # 打乱数据
    # X, y = random.shuffle(X, y)
    num_training = int(0.7 * len(X))
    X_train, y_train = X[:num_training], y[:num_training]
    X_test, y_test = X[num_training:], y[num_training:]

    rf_clf = RandomForestClassifier(n_estimators=100, max_depth=10, min_samples_split=2)

    rf_clf.fit(X_train, y_train)
    y_pred = rf_clf.predict(X_test)
    accuracy=sklearn.metrics.accuracy_score(y_test, y_pred, normalize=True, sample_weight=None)
    f1 = sklearn.metrics.f1_score(y_test, y_pred, average='weighted')
    precision=sklearn.metrics.precision_score(y_test, y_pred, average='weighted')
    print(accuracy,f1,precision)
if __name__ == '__main__':
    start = time.time()
    random_forest('E:/college/2020/ML/data/Amazon_multi.csv')
    end = time.time()
    print(end-start)
